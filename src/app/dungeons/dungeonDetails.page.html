<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      <div class="flex-space-between">
        Dungeon Details{{dungeon ? ' - ' + dungeon.name : ''}}
        <ion-button size="small" color="success" (click)="saveDungeon()">Save</ion-button>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<div *ngIf="saving" class="loading-indicator"><img src="assets/img/logo.png" alt=""></div>
<ion-content *ngIf="dungeon">
  <ion-card *ngIf="heroes">
    <ion-card-header>
      <ion-card-title>
        {{serviceAccount.name}}'s heroes
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="scrollable-list">
        <div *ngFor="let hero of heroes" (click)="selectHero(hero)" class="hero-tile-small border-grey flex-vert-center pointer mr-2">
          <ion-img [src]="'assets/img/chars/' + hero.heroBase.avatar + '.png'" class="hero-avatar-small border-bottom-grey"></ion-img>
          <div class="top-left-bubble level-bubble background-{{hero.heroBase.color}}">{{hero.level}}</div>
          <ion-img [src]="'assets/img/star_' + hero.stars + '.png'" class="hero-stars"></ion-img>
        </div>
      </div>
    </ion-card-content>
  </ion-card>
  <ion-card *ngFor="let dungeonStage of dungeon.stages" [class.background-grey]="stage && dungeonStage.stage == stage.stage">
    <ion-card-header>
      <ion-card-title>
        <div class="flex-space-between">
          Stage {{dungeonStage.stage}}
          <ion-icon *ngIf="dungeonStage.stage == dungeon.stages.length" name="trash" class="pointer" (click)="removeLastStage()"></ion-icon>
        </div>
      </ion-card-title>
    </ion-card-header>
    <ion-card-content class="pointer" (click)="selectStage(dungeonStage)">
      <ion-row>
        <ion-col sizeMd="3" *ngIf="dungeonStage.hero1">
          <div (click)="dungeonStage.hero1 = null" class="hero-tile-small border-grey pointer flex-vert-center">
            <ion-img [src]="'assets/img/chars/' + dungeonStage.hero1.heroBase.avatar + '.png'" class="hero-avatar-small border-bottom-grey"></ion-img>
            <div class="top-left-bubble level-bubble background-{{dungeonStage.hero1.heroBase.color}}">{{dungeonStage.hero1.level}}</div>
            <ion-img [src]="'assets/img/star_' + dungeonStage.hero1.stars + '.png'" class="hero-stars"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="!dungeonStage.hero1">
          <div class="hero-tile-small border-grey">
            <ion-img src="assets/img/chars/placeholder.png" class="hero-avatar-small"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="dungeonStage.hero2">
          <div (click)="dungeonStage.hero2 = null" class="hero-tile-small border-grey pointer flex-vert-center">
            <ion-img [src]="'assets/img/chars/' + dungeonStage.hero2.heroBase.avatar + '.png'" class="hero-avatar-small border-bottom-grey"></ion-img>
            <div class="top-left-bubble level-bubble background-{{dungeonStage.hero2.heroBase.color}}">{{dungeonStage.hero2.level}}</div>
            <ion-img [src]="'assets/img/star_' + dungeonStage.hero2.stars + '.png'" class="hero-stars"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="!dungeonStage.hero2">
          <div class="hero-tile-small border-grey">
            <ion-img src="assets/img/chars/placeholder.png" class="hero-avatar-small"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="dungeonStage.hero3">
          <div (click)="dungeonStage.hero3 = null" class="hero-tile-small border-grey pointer flex-vert-center">
            <ion-img [src]="'assets/img/chars/' + dungeonStage.hero3.heroBase.avatar + '.png'" class="hero-avatar-small border-bottom-grey"></ion-img>
            <div class="top-left-bubble level-bubble background-{{dungeonStage.hero3.heroBase.color}}">{{dungeonStage.hero3.level}}</div>
            <ion-img [src]="'assets/img/star_' + dungeonStage.hero3.stars + '.png'" class="hero-stars"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="!dungeonStage.hero3">
          <div class="hero-tile-small border-grey">
            <ion-img src="assets/img/chars/placeholder.png" class="hero-avatar-small"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="dungeonStage.hero4">
          <div (click)="dungeonStage.hero4 = null" class="hero-tile-small border-grey pointer flex-vert-center">
            <ion-img [src]="'assets/img/chars/' + dungeonStage.hero4.heroBase.avatar + '.png'" class="hero-avatar-small border-bottom-grey"></ion-img>
            <div class="top-left-bubble level-bubble background-{{dungeonStage.hero4.heroBase.color}}">{{dungeonStage.hero4.level}}</div>
            <ion-img [src]="'assets/img/star_' + dungeonStage.hero4.stars + '.png'" class="hero-stars"></ion-img>
          </div>
        </ion-col>
        <ion-col sizeMd="3" *ngIf="!dungeonStage.hero4">
          <div class="hero-tile-small border-grey">
            <ion-img src="assets/img/chars/placeholder.png" class="hero-avatar-small"></ion-img>
          </div>
        </ion-col>
      </ion-row>
    </ion-card-content>
  </ion-card>
  <div class="flex-center">
    <ion-button color="success" size="small" (click)="addStage()">Add Stage</ion-button>
  </div>
</ion-content>
